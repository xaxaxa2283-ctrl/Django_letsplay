{% extends 'main/base.html' %}
{% load static %}

{% block content %}
<section class="page-section">
    <div class="container">
        <div class="page-header">
            <h1>Каталог товаров</h1>
            <p>Широкий выбор игровых консолей, аксессуаров и подписок PlayStation</p>
        </div>

        <!-- Category Filters -->
        <div class="category-filters" id="categoryFilters">
            {% for category in categories %}
            <button class="filter-btn {% if forloop.first %}active{% endif %}" data-category="{{ category.id }}">
                {{ category.name }}
            </button>
            {% endfor %}
        </div>

        <!-- Products Grid -->
        <div class="products-grid" id="productsGrid">
            {% for product in products %}
            <div class="product-card" data-category="{{ product.category }}">
                {% if product.image %}
                <div class="product-image">
                    <img src="{{ product.image }}" alt="{{ product.name }}" loading="lazy">
                    {% if product.badge %}
                    <span class="product-badge">{{ product.badge }}</span>
                    {% endif %}
                </div>
                {% endif %}

                <div class="product-content">
                    <div class="product-rating">
                        {% for i in "12345" %}
                        <svg class="star {% if forloop.counter <= product.rating %}filled{% endif %}" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                        {% endfor %}
                    </div>

                    <h3 class="product-name">{{ product.name }}</h3>

                    <ul class="product-features">
                        {% for feature in product.features %}
                        <li>{{ feature }}</li>
                        {% endfor %}
                    </ul>

                    <div class="product-price">
                        <span class="price-current">{{ product.price|floatformat:0 }} ₽</span>
                        {% if product.old_price %}
                        <span class="price-old">{{ product.old_price|floatformat:0 }} ₽</span>
                        {% endif %}
                    </div>

                    <button class="btn btn-primary btn-full">Подробнее</button>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="text-center">
            <button class="btn btn-secondary">Показать ещё</button>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
// Category filter functionality
document.addEventListener('DOMContentLoaded', function() {
    const filterBtns = document.querySelectorAll('.filter-btn');
    const products = document.querySelectorAll('.product-card');

    filterBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const category = this.dataset.category;
            
            // Update active button
            filterBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // Filter products
            products.forEach(product => {
                if (category === 'all' || product.dataset.category === category) {
                    product.style.display = 'block';
                } else {
                    product.style.display = 'none';
                }
            });
        });
    });
});
</script>
{% endblock %}
