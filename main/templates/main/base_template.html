{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" type="image/x-icon" href="{% static 'images/favicon.ico' %}">
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'images/favicon.ico?v=2' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <title>{% block title %}LetsPlay — магазин приставок PlayStation в Екатеринбурге{% endblock %}</title>

{% block meta %}
<meta name="description"
      content="Магазин приставок PlayStation, XBOX в центре Екатеринбурга. Продажа PS4 и PS5, геймпадов DualSense, игр и подписок PS Plus. Самовывоз на Тургенева, 3. Гарантия.">

<meta name="robots" content="index, follow">
{% endblock %}
{% block extra_css %}{% endblock %}

<style>
  /* Корзина в шапке (второй шаблон) */
  .header-actions .cart-icon {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-left: 16px;
  }

  .header-actions .cart-icon svg {
      display: block;
  }

  #cart-counter.cart-count-badge {
      position: absolute;
      top: -6px;
      right: -10px;
      min-width: 16px;
      height: 16px;
      padding: 0 4px;
      border-radius: 999px;
      background: #00BCD4;
      color: #ffffff;
      font-size: 11px;
      line-height: 16px;
      text-align: center;
      font-weight: 600;
  }

  .mobile-menu {
    display: none;
}

.mobile-menu.open {
    display: block;
}

/* чтобы на десктопе оно не мешалось */
@media (min-width: 1024px) {
    .mobile-menu {
        display: none !important;
    }
}


/* ===== Floating contact widget (LetsPlay) ===== */

/* === ПЛАВАЮЩИЙ ВИДЖЕТ С КОНТАКТАМИ LETSPLAY === */
/* ===== Floating contact widget (LetsPlay) ===== */

/* Контейнер: фиксируем в правом нижнем углу */
.lp-contact-widget {
    position: fixed;
    right: 24px;
    bottom: 24px;
    z-index: 9999;

    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 12px;

    font-family: inherit;
}

/* Круглая кнопка-иконка */
.lp-contact-toggle {
    width: 56px;
    height: 56px;
    border-radius: 999px;
    border: none;
    cursor: pointer;

    display: flex;
    align-items: center;
    justify-content: center;

    background:
        radial-gradient(circle at 30% 0, #00e5ff 0%, transparent 55%),
        linear-gradient(135deg, #00bcd4, #0088ff);

    box-shadow: 0 14px 30px rgba(0, 0, 0, 0.45);
    transition: transform .15s ease, box-shadow .15s ease, opacity .2s ease;
}

.lp-contact-toggle svg {
    width: 26px;
    height: 26px;
    fill: #ffffff;
}

.lp-contact-toggle:hover {
    transform: translateY(-1px);
    box-shadow: 0 18px 40px rgba(0, 0, 0, 0.55);
}

.lp-contact-toggle:active {
    transform: translateY(1px) scale(.97);
    box-shadow: 0 10px 24px rgba(0,0,0,0.4);
}

/* Панель с контактами (десктоп по умолчанию) */
.lp-contact-panel {
    position: absolute;
    right: 0;
    bottom: 72px;

    width: 340px;
    max-width: calc(100vw - 32px);

    padding: 18px 20px 16px;
    border-radius: 22px;
    border: 1px solid rgba(255,255,255,0.09);

    background:
        radial-gradient(circle at top left, rgba(0, 188, 212, 0.18), transparent 55%)
        linear-gradient(135deg, rgba(4, 25, 55, 0.96), rgba(5, 35, 70, 0.96));

    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.55);
    backdrop-filter: blur(18px);

    color: #eaf5ff;

    /* анимация появления */
    opacity: 0;
    transform: translateY(10px) scale(0.98);
    pointer-events: none;

    transition:
        opacity 0.22s ease-out,
        transform 0.22s ease-out,
        box-shadow 0.22s ease-out;
}

/* когда виджет открыт */
.lp-contact-widget.lp-contact-open .lp-contact-panel {
    opacity: 1;
    transform: translateY(0) scale(1);
    pointer-events: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
}


/* Шапка панели */
.lp-contact-header {
    display: flex;
    gap: 12px;
    align-items: flex-start;
    margin-bottom: 12px;
}

.lp-contact-dot {
    width: 10px;
    height: 10px;
    border-radius: 999px;
    background: #29e370;
    box-shadow: 0 0 0 4px rgba(41,227,112,0.18);
    margin-top: 5px;
}

.lp-contact-title {
    font-size: 15px;
    font-weight: 600;
    margin-bottom: 6px;
}

.lp-contact-sub {
    font-size: 13px;
    line-height: 1.5;
    color: rgba(234,245,255,0.85);
}

/* Кнопки и ссылка */
.lp-contact-actions {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 4px;
}

.lp-contact-btn {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    padding: 9px 12px;
    border-radius: 999px;
    font-size: 14px;
    text-decoration: none;
    cursor: pointer;
    transition:
        background 0.18s ease,
        color 0.18s ease,
        transform 0.18s ease,
        box-shadow 0.18s ease;
}

.lp-contact-btn--primary {
    background: #00c853;
    color: #ffffff;
    box-shadow: 0 8px 20px rgba(0, 200, 83, 0.45);
}

.lp-contact-btn--primary:hover {
    background: #00b64b;
    transform: translateY(-1px);
    box-shadow: 0 10px 24px rgba(0, 200, 83, 0.55);
}

.lp-contact-btn--outline {
    background: transparent;
    color: #e9f4ff;
    border: 1px solid rgba(233,244,255,0.3);
}

.lp-contact-btn--outline:hover {
    background: rgba(233,244,255,0.06);
}

.lp-contact-link {
    margin-top: 2px;
    font-size: 13px;
    color: #7ee7ff;
    text-decoration: none;
}

.lp-contact-link:hover {
    color: #b3f4ff;
}

/* ================== МОБИЛКА ================== */
@media (max-width: 640px) {
    .lp-contact-widget {
        right: 12px;
        bottom: 12px;
    }

    .lp-contact-toggle {
        width: 52px;
        height: 52px;
    }

    .lp-contact-panel {
        left: 12px !important;
        right: 12px !important;
        bottom: 80px !important;

        width: auto !important;
        max-width: none !important;

        padding: 14px 16px 12px;
        border-radius: 18px;

        max-height: 60vh;      /* можно прокрутить, если текста много */
        overflow-y: auto;
    }

    .lp-contact-title {
        font-size: 14px;
        margin-bottom: 4px;
    }

    .lp-contact-sub {
        font-size: 12px;
        line-height: 1.45;
    }

    .lp-contact-actions {
        gap: 6px;
        margin-top: 4px;
    }

    .lp-contact-btn {
        font-size: 13px;
        padding: 8px 10px;
    }

    .lp-contact-link {
        font-size: 12px;
        margin-top: 0;
    }
}
/* --- Жёсткий фикс виджета на мобилке --- */
@media (max-width: 640px) {

    /* Контейнер снизу справа */
    .lp-contact-widget {
        right: 12px !important;
        bottom: 12px !important;
        align-items: center; /* чтобы панель центрировалась относительно экрана */
    }

    .lp-contact-toggle {
        width: 52px !important;
        height: 52px !important;
    }

    /* Делаем панель нормальной ширины и по центру */
    .lp-contact-panel {
        position: fixed !important;          /* оторвали от маленького контейнера */
        left: 50% !important;
        right: auto !important;
        bottom: 80px !important;

        width: min(360px, 100vw - 24px) !important;
        max-width: 100vw !important;

        padding: 14px 16px 12px !important;
        border-radius: 18px !important;

        max-height: 60vh !important;
        overflow-y: auto !important;

        transform: translate(-50%, 12px); /* скрытое состояние – чуть ниже */
    }

    /* Когда открыто – тоже центр, но без смещения по Y */
    .lp-contact-widget.lp-contact-open .lp-contact-panel {
        transform: translate(-50%, 0) !important;
    }

    .lp-contact-title {
        font-size: 14px !important;
        margin-bottom: 4px !important;
    }

    .lp-contact-sub {
        font-size: 12px !important;
        line-height: 1.45 !important;
    }

    .lp-contact-actions {
        gap: 6px !important;
        margin-top: 4px !important;
    }

    .lp-contact-btn {
        font-size: 13px !important;
        padding: 8px 10px !important;
    }

    .lp-contact-link {
        font-size: 12px !important;
        margin-top: 0 !important;
    }
}
@media (min-width: 768px) {
    .lp-contact-toggle {
        animation: lp-contact-glow 2.4s ease-in-out infinite;
    }

    /* когда панель открыта – не мигаем, чтобы не отвлекать */
    .lp-contact-widget.lp-contact-open .lp-contact-toggle {
        animation: none;
    }
}

@keyframes lp-contact-glow {
    0%, 100% {
        box-shadow:
            0 14px 30px rgba(0, 0, 0, 0.45),
            0 0 0 rgba(0, 229, 255, 0.0);
    }
    50% {
        box-shadow:
            0 14px 30px rgba(0, 0, 0, 0.45),
            0 0 18px rgba(0, 229, 255, 0.85);
    }
}

</style>





<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105346552', 'ym');

    ym(105346552, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105346552&quot;" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->



{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "VideoGameStore",
  "name": "LetsPlay",
  "url": "{% if request.is_secure %}https{% else %}http{% endif %}://{{ request.get_host }}/",
  "telephone": "+7 999 499 36 41",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "ул. Тургенева, 3",
    "addressLocality": "Екатеринбург",
    "addressRegion": "Свердловская область",
    "postalCode": "",
    "addressCountry": "RU"
  },
  "priceRange": "₽₽",
  "image": "{% static 'images/about_us.jpg' %}",
  "sameAs": [
    "https://vk.com/letsplayekb",
    "https://t.me/letsplayekb_bot"
  ]
}
</script>
{% endblock %}
</head>
<body>

    <!-- Фон с анимацией -->
    <div class="gradient-bg">
        <div class="gradient-layer-1"></div>
        <div class="gradient-layer-2"></div>
    </div>

    <!-- Шапка -->
    <header class="header">
        <div class="container header-content">

            <a href="{% url 'letsplay:home' %}" class="logo">
                <div class="logo-box">LetsPlay</div>
            </a>

            <!-- Навигация -->
            <nav class="nav-desktop">
                <a href="{% url 'letsplay:home' %}" class="nav-link {% if page == 'home' %}active{% endif %}">ГЛАВНАЯ</a>
                <a href="{% url 'letsplay:about' %}" class="nav-link {% if page == 'about' %}active{% endif %}">О НАС</a>
                <a href="{% url 'letsplay:catalog' %}" class="nav-link {% if page == 'catalog' %}active{% endif %}">КАТАЛОГ</a>
                <a href="{% url 'letsplay:reviews' %}" class="nav-link {% if page == 'reviews' %}active{% endif %}">ОТЗЫВЫ</a>

            </nav>

            <div class="header-actions">
                {% if user.is_authenticated %}
                    <a href="{% url 'letsplay:my_orders_page' %}" class="btn btn-secondary">Профиль</a>
                {% else %}
                    <a href="{% url 'letsplay:login' %}" class="btn btn-primary">Войти</a>
                {% endif %}

                <!-- Корзина -->
                <a href="{% url 'letsplay:cart_view' %}" class="cart-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="24" height="24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 2.25l1.5 1.5m0 0L6 12.75h12.75L21 6H5.25m-1.5-2.25L5.25 6m0 0l.75 3M6 12.75h12.75M9 21a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm9 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
                    </svg>
                        <span id="cart-counter" class="cart-count-badge">
            {{ cart_count }}
        </span>
                </a>

                <!-- Кнопка меню для мобилы -->
                <button class="mobile-menu-btn" id="menu-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Мобильное меню -->
        <div class="mobile-menu" id="mobile-menu">
            <nav class="mobile-nav">
                <a href="{% url 'letsplay:home' %}" class="nav-link {% if page == 'home' %}active{% endif %}">ГЛАВНАЯ</a>
                <a href="{% url 'letsplay:about' %}" class="nav-link {% if page == 'about' %}active{% endif %}">О НАС</a>
                <a href="{% url 'letsplay:catalog' %}" class="nav-link {% if page == 'catalog' %}active{% endif %}">КАТАЛОГ</a>
                <a href="{% url 'letsplay:reviews' %}" class="nav-link {% if page == 'reviews' %}active{% endif %}">ОТЗЫВЫ</a>
            </nav>

            <div class="mobile-phone">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h2l3 7-1.5 4.5L9 19l3-2 5.5 2L21 7H7" />
                </svg>
                <span>+7 999 499 36 41</span>
            </div>
        </div>
    </header>

    <!-- Основной контент -->
    <main>
        {% block content %}
        {% endblock %}
    </main>

    <!-- Подвал -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="logo logo-footer">
                        <div class="logo-box">LetsPlay</div>
                    </div>
                    <p class="footer-text">
                        Магазин игровых консолей нового поколения.  
                        Лучшие цены, быстрая доставка и забота о клиентах.
                    </p>
                </div>

                <div class="footer-section">
                    <h4 class="footer-title">Меню</h4>
                    <nav class="footer-nav">
                        <a href="{% url 'letsplay:home' %}">Главная</a>
                        <a href="{% url 'letsplay:about' %}">О нас</a>
                        <a href="{% url 'letsplay:catalog' %}">Каталог</a>
                        <a href="{% url 'letsplay:reviews' %}">Отзывы</a>
                    </nav>
                </div>

                <div class="footer-section">
                    <h4 class="footer-title">Контакты</h4>
                    <div class="footer-contacts">
                        <p>+7 999 499 36 41</p>
                        <p>letsplay.ekb@yandex.ru</p>
                        <p>Екатеринбург, Тургенева 3</p>
                    </div>
                </div>

                <div class="footer-section">
                    <h4 class="footer-title">Мы в соцсетях</h4>
                    <div class="footer-nav">
                        <a href="https://vk.com/letsplayekb">VK</a>
                        <a class="tn-atom" href="https://t.me/letsplayekb_bot" target="_blank" rel="noopener">Telegram</a>
                        <a href="https://wa.me/message/WTMGO5P7SVUYM1" >WhatsApp</a>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>© 2025 LetsPlay. Все права защищены.</p>
            </div>
        </div>


        <div class="mt-4 text-center">
    <a href="{% url 'letsplay:privacy_policy' %}"
       class="text-white/60 hover:text-white transition">
        Политика конфиденциальности
    </a>
</div>
    </footer>
<!-- Floating contact widget -->
<div class="lp-contact-widget" id="lp-contact-widget">
    <!-- Кнопка-иконка -->
    <button class="lp-contact-toggle" id="lp-contact-toggle" aria-label="Связаться с LetsPlay">
        <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 3C7.03 3 3 6.58 3 11c0 1.78.64 3.44 1.76 4.8L3 21l5.4-1.78C9.3 19.73 10.62 20 12 20c4.97 0 9-3.58 9-8s-4.03-9-9-9zm-1 5h2v2h-2V8zm0 3h2v5h-2v-5z"/>
        </svg>
    </button>

    <!-- Панель -->
    <div class="lp-contact-panel" id="lp-contact-panel" aria-hidden="true">
    <div class="lp-contact-header">
        <span class="lp-contact-dot"></span>
        <div>
            <div class="lp-contact-title">Нужна помощь с приставкой?</div>
            <div class="lp-contact-sub">
                Ответим за 1–2 минуты и поможем выбрать приставку,
                комплектацию и игры под ваш бюджет.
            </div>
        </div>
    </div>

    <div class="lp-contact-actions">
        <a href="https://wa.me/message/WTMGO5P7SVUYM1" target="_blank"
           class="lp-contact-btn lp-contact-btn--primary">
            Написать в WhatsApp
        </a>
        <a href="tel:+79994993641" class="lp-contact-btn lp-contact-btn--outline">
            Позвонить в магазин
        </a>
        <a href="{% url 'letsplay:service_console_selection' %}" class="lp-contact-link">
            Подобрать приставку под задачи →
        </a>
    </div>
</div>

</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const btn  = document.getElementById('menu-toggle');
    const menu = document.getElementById('mobile-menu');

    if (!btn || !menu) return;

    btn.addEventListener('click', function () {
        menu.classList.toggle('open');
    });
});

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function updateCartCounter() {
    console.log("[updateCartCounter] called");
    fetch("/cart-count/")
        .then(response => response.json())
        .then(data => {
            console.log("[updateCartCounter] got", data);
            const counter = document.getElementById("cart-counter");
            if (counter) { counter.innerText = data.count; }
        })
        .catch(err => console.error("[updateCartCounter] error", err));
}

function addToCart(productId) {
    console.log("[addToCart] productId=", productId);
    fetch(`/add-to-cart/${productId}/`, {
        method: "POST",
        credentials: "same-origin",
        headers: {
            "X-Requested-With": "XMLHttpRequest",
            "X-CSRFToken": getCookie("csrftoken"),
            "Accept": "application/json"
        }
    })
    .then(res => {
        console.log("[addToCart] response status", res.status);
        return res.json().catch(() => ({ok:false, error: "invalid_json"}));
    })
    .then(data => {
        console.log("[addToCart] json:", data);
        if (data.ok) {
            updateCartCounter();
        } else {
            alert("Add to cart failed: " + (data.error || JSON.stringify(data)));
        }
    })
    .catch(err => {
        console.error("[addToCart] fetch error", err);
        alert("Network error, see console");
    });
}



document.addEventListener('DOMContentLoaded', function () {
    const widget = document.getElementById('lp-contact-widget');
    const toggle = document.getElementById('lp-contact-toggle');
    const panel  = document.getElementById('lp-contact-panel');

    if (!widget || !toggle || !panel) return;

    const OPEN_CLASS = 'lp-contact-open';

    toggle.addEventListener('click', function (e) {
        e.stopPropagation();
        const isOpen = widget.classList.toggle(OPEN_CLASS);
        panel.setAttribute('aria-hidden', isOpen ? 'false' : 'true');
    });

    document.addEventListener('click', function (e) {
        if (!widget.classList.contains(OPEN_CLASS)) return;
        if (!widget.contains(e.target)) {
            widget.classList.remove(OPEN_CLASS);
            panel.setAttribute('aria-hidden', 'true');
        }
    });

    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && widget.classList.contains(OPEN_CLASS)) {
            widget.classList.remove(OPEN_CLASS);
            panel.setAttribute('aria-hidden', 'true');
        }
    });
});

</script>




{% block extra_js %}{% endblock %}
</body>
</html>

