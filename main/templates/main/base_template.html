{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" type="image/x-icon" href="{% static 'images/favicon.ico' %}">
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'images/favicon.ico?v=2' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
{% block title %}{{ title }}{% endblock %}
{% block meta %}
<meta name="description"
      content="LetsPlay — магазин приставок PlayStation в Екатеринбурге. PS4, PS5, геймпады DualSense, игры и подписки с гарантией и настройкой. Магазин на Тургенева 3.">
<meta name="keywords"
      content="купить ps5 екатеринбург, купить ps4 екатеринбург, приставка playstation, магазин приставок екатеринбург, dualsense екатеринбург">
<meta name="robots" content="index, follow">
{% endblock %}
{% block extra_css %}{% endblock %}

<style>
  /* Корзина в шапке (второй шаблон) */
  .header-actions .cart-icon {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-left: 16px;
  }

  .header-actions .cart-icon svg {
      display: block;
  }

  #cart-counter.cart-count-badge {
      position: absolute;
      top: -6px;
      right: -10px;
      min-width: 16px;
      height: 16px;
      padding: 0 4px;
      border-radius: 999px;
      background: #00BCD4;
      color: #ffffff;
      font-size: 11px;
      line-height: 16px;
      text-align: center;
      font-weight: 600;
  }

  .mobile-menu {
    display: none;
}

.mobile-menu.open {
    display: block;
}

/* чтобы на десктопе оно не мешалось */
@media (min-width: 1024px) {
    .mobile-menu {
        display: none !important;
    }
}

</style>
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105346552', 'ym');

    ym(105346552, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105346552&quot;" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->



{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "VideoGameStore",
  "name": "LetsPlay",
  "url": "{% if request.is_secure %}https{% else %}http{% endif %}://{{ request.get_host }}/",
  "telephone": "+7 999 499 36 41",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "ул. Тургенева, 3",
    "addressLocality": "Екатеринбург",
    "addressRegion": "Свердловская область",
    "postalCode": "",
    "addressCountry": "RU"
  },
  "priceRange": "₽₽",
  "image": "{% static 'images/about_us.jpg' %}",
  "sameAs": [
    "https://vk.com/letsplayekb",
    "https://t.me/letsplayekb_bot"
  ]
}
</script>
{% endblock %}
</head>
<body>

    <!-- Фон с анимацией -->
    <div class="gradient-bg">
        <div class="gradient-layer-1"></div>
        <div class="gradient-layer-2"></div>
    </div>

    <!-- Шапка -->
    <header class="header">
        <div class="container header-content">

            <a href="{% url 'letsplay:home' %}" class="logo">
                <div class="logo-box">LetsPlay</div>
            </a>

            <!-- Навигация -->
            <nav class="nav-desktop">
                <a href="{% url 'letsplay:home' %}" class="nav-link {% if page == 'home' %}active{% endif %}">ГЛАВНАЯ</a>
                <a href="{% url 'letsplay:about' %}" class="nav-link {% if page == 'about' %}active{% endif %}">О НАС</a>
                <a href="{% url 'letsplay:catalog' %}" class="nav-link {% if page == 'catalog' %}active{% endif %}">КАТАЛОГ</a>
                <a href="{% url 'letsplay:reviews' %}" class="nav-link {% if page == 'reviews' %}active{% endif %}">ОТЗЫВЫ</a>

            </nav>

            <div class="header-actions">
                {% if user.is_authenticated %}
                    <a href="{% url 'letsplay:my_orders_page' %}" class="btn btn-secondary">Профиль</a>
                {% else %}
                    <a href="{% url 'letsplay:login' %}" class="btn btn-primary">Войти</a>
                {% endif %}

                <!-- Корзина -->
                <a href="{% url 'letsplay:cart_view' %}" class="cart-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="24" height="24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 2.25l1.5 1.5m0 0L6 12.75h12.75L21 6H5.25m-1.5-2.25L5.25 6m0 0l.75 3M6 12.75h12.75M9 21a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm9 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
                    </svg>
                        <span id="cart-counter" class="cart-count-badge">
            {{ cart_count }}
        </span>
                </a>

                <!-- Кнопка меню для мобилы -->
                <button class="mobile-menu-btn" id="menu-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Мобильное меню -->
        <div class="mobile-menu" id="mobile-menu">
            <nav class="mobile-nav">
                <a href="{% url 'letsplay:home' %}" class="nav-link {% if page == 'home' %}active{% endif %}">ГЛАВНАЯ</a>
                <a href="{% url 'letsplay:about' %}" class="nav-link {% if page == 'about' %}active{% endif %}">О НАС</a>
                <a href="{% url 'letsplay:catalog' %}" class="nav-link {% if page == 'catalog' %}active{% endif %}">КАТАЛОГ</a>
                <a href="{% url 'letsplay:reviews' %}" class="nav-link {% if page == 'reviews' %}active{% endif %}">ОТЗЫВЫ</a>
            </nav>

            <div class="mobile-phone">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h2l3 7-1.5 4.5L9 19l3-2 5.5 2L21 7H7" />
                </svg>
                <span>+7 999 499 36 41</span>
            </div>
        </div>
    </header>

    <!-- Основной контент -->
    <main>
        {% block content %}
        {% endblock %}
    </main>

    <!-- Подвал -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="logo logo-footer">
                        <div class="logo-box">LetsPlay</div>
                    </div>
                    <p class="footer-text">
                        Магазин игровых консолей нового поколения.  
                        Лучшие цены, быстрая доставка и забота о клиентах.
                    </p>
                </div>

                <div class="footer-section">
                    <h4 class="footer-title">Меню</h4>
                    <nav class="footer-nav">
                        <a href="{% url 'letsplay:home' %}">Главная</a>
                        <a href="{% url 'letsplay:about' %}">О нас</a>
                        <a href="{% url 'letsplay:catalog' %}">Каталог</a>
                        <a href="{% url 'letsplay:reviews' %}">Отзывы</a>
                    </nav>
                </div>

                <div class="footer-section">
                    <h4 class="footer-title">Контакты</h4>
                    <div class="footer-contacts">
                        <p>+7 999 499 36 41</p>
                        <p>letsplay.ekb@yandex.ru</p>
                        <p>Екатеринбург, Тургенева 3</p>
                    </div>
                </div>

                <div class="footer-section">
                    <h4 class="footer-title">Мы в соцсетях</h4>
                    <div class="footer-nav">
                        <a href="https://vk.com/letsplayekb">VK</a>
                        <a class="tn-atom" href="https://t.me/letsplayekb_bot" target="_blank" rel="noopener">Telegram</a>
                        <a href="https://wa.me/message/WTMGO5P7SVUYM1" >WhatsApp</a>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>© 2025 LetsPlay. Все права защищены.</p>
            </div>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const btn  = document.getElementById('menu-toggle');
    const menu = document.getElementById('mobile-menu');

    if (!btn || !menu) return;

    btn.addEventListener('click', function () {
        menu.classList.toggle('open');
    });
});

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function updateCartCounter() {
    console.log("[updateCartCounter] called");
    fetch("/cart-count/")
        .then(response => response.json())
        .then(data => {
            console.log("[updateCartCounter] got", data);
            const counter = document.getElementById("cart-counter");
            if (counter) { counter.innerText = data.count; }
        })
        .catch(err => console.error("[updateCartCounter] error", err));
}

function addToCart(productId) {
    console.log("[addToCart] productId=", productId);
    fetch(`/add-to-cart/${productId}/`, {
        method: "POST",
        credentials: "same-origin",
        headers: {
            "X-Requested-With": "XMLHttpRequest",
            "X-CSRFToken": getCookie("csrftoken"),
            "Accept": "application/json"
        }
    })
    .then(res => {
        console.log("[addToCart] response status", res.status);
        return res.json().catch(() => ({ok:false, error: "invalid_json"}));
    })
    .then(data => {
        console.log("[addToCart] json:", data);
        if (data.ok) {
            updateCartCounter();
        } else {
            alert("Add to cart failed: " + (data.error || JSON.stringify(data)));
        }
    })
    .catch(err => {
        console.error("[addToCart] fetch error", err);
        alert("Network error, see console");
    });
}
</script>

{% block extra_js %}{% endblock %}
</body>
</html>

